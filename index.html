<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Break Tracker Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Inter', sans-serif; }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #94a3b8; }
        .glass-effect { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .nav-item.active { background-color: #eef2ff; color: #4338ca; }
        
        /* Transitions for form switching */
        .form-container { transition: all 0.3s ease-in-out; }
    </style>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, doc, setDoc, onSnapshot, serverTimestamp, updateDoc, getDoc, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // --- CONFIGURATION ---
        const firebaseConfig = JSON.parse(__firebase_config);
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- APP STATE ---
        let currentUser = null; 
        let currentAgentName = localStorage.getItem('break_tracker_agent') || null; 
        let breakDataMap = {}; 
        let usersDataMap = {}; // Stores all registered users
        let sessionLogs = []; 

        // --- INITIAL SEED DATA (Used if DB is empty) ---
        const INITIAL_USERS = [
            { email: "d.kamesh@opendoor.com", password: "12345678", name: "Kamesh D", role: "Admin" },
        ];

        // --- AUTH FLOW ---
        async function initAuth() {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                     await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                     await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth Error:", error);
                showToast("Authentication failed. Please refresh.", "error");
            }
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                currentUser = user;
                initDataListeners();
            }
        });

        // --- DATA LISTENERS ---
        function initDataListeners() {
            if (!currentUser) return;
            
            // 1. Listen for Breaks
            const breaksRef = collection(db, 'artifacts', appId, 'public', 'data', 'breaks');
            onSnapshot(breaksRef, (snapshot) => {
                breakDataMap = {};
                snapshot.forEach(doc => breakDataMap[doc.id] = doc.data());
                updateDashboard();
            });

            // 2. Listen for Users (Team List)
            const usersRef = collection(db, 'artifacts', appId, 'public', 'data', 'users');
            onSnapshot(usersRef, (snapshot) => {
                usersDataMap = {};
                if (snapshot.empty) {
                    seedInitialUsers(); // Populate if empty
                } else {
                    snapshot.forEach(doc => usersDataMap[doc.id] = doc.data());
                    
                    // Check if we are logged in
                    if (currentAgentName && usersDataMap[currentAgentName]) {
                        showDashboard();
                    } else if (currentAgentName && !usersDataMap[currentAgentName]) {
                        // Handle case where localstorage has a user that was deleted from DB
                        attemptLogout(); 
                    } else {
                        showAuthScreen('login');
                    }
                    updateDashboard();
                }
            });
        }

        async function seedInitialUsers() {
            const batch = writeBatch(db);
            INITIAL_USERS.forEach(user => {
                const ref = doc(db, 'artifacts', appId, 'public', 'data', 'users', user.name);
                batch.set(ref, user);
            });
            await batch.commit();
        }

        // --- FORM HANDLING ---
        window.toggleAuthForm = (formType) => {
            // forms: 'login', 'signup', 'forgot'
            document.querySelectorAll('.auth-form').forEach(el => el.classList.add('hidden'));
            document.getElementById(`form-${formType}`).classList.remove('hidden');
            
            // Reset errors
            document.querySelectorAll('.error-msg').forEach(el => el.classList.add('hidden'));
        };

        window.handleSignup = async (e) => {
            e.preventDefault();
            const name = document.getElementById('signup-name').value.trim();
            const email = document.getElementById('signup-email').value.trim();
            const pass = document.getElementById('signup-pass').value.trim();

            if (!name || !email || !pass) {
                showError('signup-error', 'All fields are required');
                return;
            }

            // Check if user already exists (by name or email)
            const existingName = usersDataMap[name];
            const existingEmail = Object.values(usersDataMap).find(u => u.email.toLowerCase() === email.toLowerCase());

            if (existingName || existingEmail) {
                showError('signup-error', 'User already exists. Please login.');
                return;
            }

            try {
                const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'users', name);
                await setDoc(docRef, {
                    name: name,
                    email: email,
                    password: pass, // Note: In a real app, never store plain passwords!
                    role: 'User',
                    joinedAt: serverTimestamp()
                });
                
                // Auto login
                currentAgentName = name;
                localStorage.setItem('break_tracker_agent', currentAgentName);
                showDashboard();
                showToast("Account created successfully!", "success");
            } catch (err) {
                console.error(err);
                showError('signup-error', 'Failed to create account.');
            }
        };

        window.handleLogin = (e) => {
            e.preventDefault();
            const email = document.getElementById('login-email').value.trim();
            const pass = document.getElementById('login-pass').value.trim();

            const userMatch = Object.values(usersDataMap).find(u => u.email.toLowerCase() === email.toLowerCase() && u.password === pass);

            if (userMatch) {
                currentAgentName = userMatch.name;
                localStorage.setItem('break_tracker_agent', currentAgentName);
                showDashboard();
            } else {
                showError('login-error', 'Invalid Email or Password');
            }
        };

        window.handleForgotPass = (e) => {
            e.preventDefault();
            const email = document.getElementById('forgot-email').value.trim();
            const userMatch = Object.values(usersDataMap).find(u => u.email.toLowerCase() === email.toLowerCase());

            if (userMatch) {
                // Mock sending email
                showToast(`Reset link sent to ${email}`, "success");
                setTimeout(() => toggleAuthForm('login'), 2000);
            } else {
                showError('forgot-error', 'Email not found');
            }
        };

        function showError(id, msg) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.classList.remove('hidden');
        }

        // --- DASHBOARD ACTIONS ---
        window.handleBreakIn = async (agentName) => {
            if (agentName !== currentAgentName) return; 
            const data = breakDataMap[agentName] || {};
            if (data.status === 'On Break') return;
            
            // -- FIXED LOGIC: Use Milliseconds for precision --
            // Use existing accumulatedMs or fallback to minutes conversion
            const usedMs = data.accumulatedMs || ((data.totalBreak || 0) * 60000);
            const limitMs = 60 * 60 * 1000; // 60 minutes in ms

            if (usedMs >= limitMs) {
                showToast("Daily limit reached!", "error");
                return;
            }

            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'breaks', agentName);
            await setDoc(docRef, {
                name: agentName, 
                status: 'On Break', 
                breakStart: Date.now(), 
                // Preserve existing accumulation or init with current used
                accumulatedMs: usedMs, 
                totalBreak: Math.ceil(usedMs / 60000), // Keep minutes for legacy/sort
                lastUpdated: serverTimestamp()
            }, { merge: true });
            
            addToLog(agentName, "Started Break", "Now");
            showToast("Break Started", "success");
        };

        window.handleBreakOut = async (agentName) => {
            if (agentName !== currentAgentName) return;
            const data = breakDataMap[agentName];
            if (!data || data.status !== 'On Break') return;

            const now = Date.now();
            const start = data.breakStart || now;
            const durationMs = now - start;
            
            // -- FIXED LOGIC: Accumulate milliseconds --
            const prevMs = data.accumulatedMs || ((data.totalBreak || 0) * 60000);
            const newTotalMs = prevMs + durationMs;
            
            // Convert to minutes for coarse display (rounding up to ensure we don't show 0m for 30s)
            const displayMinutes = Math.ceil(newTotalMs / 60000);
            
            const docRef = doc(db, 'artifacts', appId, 'public', 'data', 'breaks', agentName);
            await updateDoc(docRef, {
                status: 'Working', 
                breakStart: null, 
                accumulatedMs: newTotalMs, // Save exact time
                totalBreak: displayMinutes,
                lastUpdated: serverTimestamp()
            });
            
            // Format log nicely
            const seconds = Math.floor(durationMs / 1000);
            const logText = seconds >= 60 
                ? `+${Math.floor(seconds/60)}m ${seconds%60}s` 
                : `+${seconds}s`;
            
            addToLog(agentName, "Ended Break", logText);
            showToast(`Break Ended (${logText})`, "success");
        };

        function addToLog(agent, action, details) {
            sessionLogs.unshift({ time: new Date().toLocaleTimeString(), agent, action, details });
            renderHistory();
        }

        // --- UI RENDERING ---
        window.attemptLogout = () => {
            currentAgentName = null;
            localStorage.removeItem('break_tracker_agent');
            showAuthScreen('login');
        };

        function showAuthScreen(type) {
            document.getElementById('authSection').classList.remove('hidden');
            document.getElementById('dashboardWrapper').classList.add('hidden');
            toggleAuthForm(type);
        }

        function showDashboard() {
            document.getElementById('authSection').classList.add('hidden');
            document.getElementById('dashboardWrapper').classList.remove('hidden');
            
            // Setup Header
            document.getElementById('welcomeUser').textContent = currentAgentName;
            const names = currentAgentName.split(' ');
            document.getElementById('userAvatarInitials').textContent = names[0][0] + (names.length > 1 ? names[names.length-1][0] : '');
            
            // Setup Settings Profile
            const userObj = usersDataMap[currentAgentName] || { role: 'Agent', email: '' };
            document.getElementById('settingsName').textContent = currentAgentName;
            document.getElementById('settingsRole').textContent = userObj.role;

            updateDashboard();
        }

        function updateDashboard() {
            updateStats();
            renderTeamTable();
            renderTeamGrid();
        }

        function updateStats() {
            const allUsers = Object.keys(usersDataMap);
            let totalAgents = allUsers.length;
            let onBreakCount = 0;
            let maxBreakMs = 0;
            let topBreakerName = "None";

            allUsers.forEach(name => {
                const data = breakDataMap[name] || {};
                if (data.status === 'On Break') onBreakCount++;
                
                const accMs = data.accumulatedMs || ((data.totalBreak || 0) * 60000);
                if (accMs > maxBreakMs) {
                    maxBreakMs = accMs;
                    topBreakerName = name;
                }
            });

            document.getElementById('statTotal').innerText = totalAgents;
            document.getElementById('statWorking').innerText = totalAgents - onBreakCount;
            document.getElementById('statBreak').innerText = onBreakCount;
            document.getElementById('statTopName').innerText = topBreakerName;
            document.getElementById('statTopTime').innerText = Math.ceil(maxBreakMs / 60000) + "m";
        }

        function renderTeamTable() {
            const tbody = document.getElementById('teamBody');
            tbody.innerHTML = '';

            const sortedAgents = Object.keys(usersDataMap).sort((a, b) => {
                const statusA = breakDataMap[a]?.status === 'On Break' ? 0 : 1;
                const statusB = breakDataMap[b]?.status === 'On Break' ? 0 : 1;
                if (statusA !== statusB) return statusA - statusB;
                return a.localeCompare(b);
            });

            sortedAgents.forEach(name => {
                const data = breakDataMap[name] || { status: 'Working', totalBreak: 0 };
                const isMe = name === currentAgentName;
                const isOnBreak = data.status === 'On Break';
                
                // Calculation
                const accMs = data.accumulatedMs || ((data.totalBreak || 0) * 60000);
                const totalMins = Math.ceil(accMs / 60000);
                const remainingMins = Math.max(0, 60 - totalMins);
                
                let statusBadge = isOnBreak 
                    ? `<span class="px-3 py-1 inline-flex text-xs font-semibold rounded-full bg-rose-100 text-rose-700 border border-rose-200 animate-pulse"><i class="fas fa-mug-hot mr-1.5"></i> On Break</span>`
                    : `<span class="px-3 py-1 inline-flex text-xs font-semibold rounded-full bg-emerald-100 text-emerald-700 border border-emerald-200"><i class="fas fa-laptop mr-1.5"></i> Working</span>`;

                let actionBtn = `<span class="text-slate-300 text-xs">view only</span>`;
                if (isMe) {
                    if (isOnBreak) actionBtn = `<button onclick="handleBreakOut('${name}')" class="bg-white border border-rose-200 text-rose-600 hover:bg-rose-50 px-4 py-1.5 rounded-md text-sm font-medium shadow-sm">End Break</button>`;
                    else if (totalMins >= 60) actionBtn = `<span class="text-rose-500 text-xs font-bold">Limit Reached</span>`;
                    else actionBtn = `<button onclick="handleBreakIn('${name}')" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-1.5 rounded-md text-sm font-medium shadow-sm">Start Break</button>`;
                }

                const rowClass = isOnBreak ? "bg-rose-50/30" : "hover:bg-slate-50";
                const names = name.split(' ');
                const initials = names[0][0] + (names.length > 1 ? names[names.length-1][0] : '');
                
                // Progress bar color
                const progressColor = totalMins >= 60 ? 'bg-rose-500' : totalMins >= 45 ? 'bg-amber-400' : 'bg-emerald-500';
                const progressWidth = Math.min((totalMins/60)*100, 100);

                tbody.innerHTML += `
                    <tr class="${rowClass} border-b border-slate-100 last:border-0 transition-colors">
                        <td class="px-6 py-4">
                            <div class="flex items-center">
                                <div class="h-9 w-9 rounded-full bg-slate-200 text-slate-600 flex items-center justify-center text-xs font-bold">${initials}</div>
                                <div class="ml-4"><div class="text-sm font-medium text-slate-900">${name}</div><div class="text-xs text-slate-500">${isMe ? '(You)' : ''}</div></div>
                            </div>
                        </td>
                        <td class="px-6 py-4">${statusBadge}</td>
                        <td class="px-6 py-4">
                            <div class="w-full max-w-xs">
                                <div class="flex justify-between text-xs mb-1">
                                    <span class="font-medium text-slate-700">${totalMins}m used</span>
                                    <span class="text-slate-500">${remainingMins}m remaining</span>
                                </div>
                                <div class="w-full bg-slate-100 rounded-full h-2 overflow-hidden">
                                    <div class="${progressColor} h-2 rounded-full transition-all duration-500" style="width: ${progressWidth}%"></div>
                                </div>
                            </div>
                        </td>
                        <td class="px-6 py-4 text-right">${actionBtn}</td>
                    </tr>`;
            });
        }

        function renderTeamGrid() {
            const grid = document.getElementById('teamGrid');
            grid.innerHTML = '';
            Object.keys(usersDataMap).forEach(name => {
                const data = breakDataMap[name] || { status: 'Working', totalBreak: 0 };
                const names = name.split(' ');
                const initials = names[0][0];
                
                const accMs = data.accumulatedMs || ((data.totalBreak || 0) * 60000);
                const totalMins = Math.ceil(accMs / 60000);

                grid.innerHTML += `
                    <div class="p-4 rounded-xl border ${data.status==='On Break'?'bg-rose-50 border-rose-200':'bg-white border-slate-200'} shadow-sm flex flex-col items-center text-center gap-3">
                        <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center font-bold text-sm">${initials}</div>
                        <div><p class="font-bold text-sm truncate w-24">${name}</p><p class="text-xs ${data.status==='On Break'?'text-rose-500':'text-emerald-600'}">${data.status || 'Working'}</p></div>
                        <div class="w-full bg-slate-100 h-1 rounded-full overflow-hidden mt-1"><div class="h-full bg-indigo-500" style="width: ${Math.min((totalMins/60)*100, 100)}%"></div></div>
                    </div>`;
            });
        }

        // Navigation & Utils
        window.switchView = (viewId) => {
            document.querySelectorAll('.app-view').forEach(el => el.classList.add('hidden'));
            document.getElementById('view-' + viewId).classList.remove('hidden');
            document.querySelectorAll('.nav-item').forEach(el => {
                el.classList.remove('active', 'bg-indigo-50', 'text-indigo-700');
                el.classList.add('text-slate-600', 'hover:bg-slate-50');
            });
            document.getElementById('nav-' + viewId).classList.add('active', 'bg-indigo-50', 'text-indigo-700');
            document.getElementById('nav-' + viewId).classList.remove('text-slate-600', 'hover:bg-slate-50');
            if(viewId === 'history') renderHistory();
        }

        function renderHistory() {
            const tbody = document.getElementById('historyBody');
            if (sessionLogs.length === 0) { tbody.innerHTML = `<tr><td colspan="4" class="text-center py-8 text-slate-400 text-sm">No activity yet.</td></tr>`; return; }
            tbody.innerHTML = sessionLogs.map(log => `
                <tr class="border-b border-slate-100 hover:bg-slate-50 text-sm">
                    <td class="px-6 py-3 text-slate-500">${log.time}</td><td class="px-6 py-3 font-medium">${log.agent}</td>
                    <td class="px-6 py-3"><span class="px-2 py-1 rounded text-xs font-bold ${log.action.includes('Started')?'bg-rose-100 text-rose-700':'bg-emerald-100 text-emerald-700'}">${log.action}</span></td>
                    <td class="px-6 py-3 text-slate-600">${log.details}</td>
                </tr>`).join('');
        }

        function showToast(msg, type="info") {
            const toast = document.createElement('div');
            toast.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-xl border-l-4 transform transition-all duration-300 translate-x-full opacity-0 z-50 flex items-center gap-3 bg-white text-slate-800 ${type === 'error' ? 'border-rose-500' : 'border-emerald-500'}`;
            toast.innerHTML = `<div><h4 class="font-bold text-sm">${type === 'error' ? 'Error' : 'Success'}</h4><p class="text-xs text-slate-500">${msg}</p></div>`;
            document.body.appendChild(toast);
            requestAnimationFrame(() => toast.classList.remove('translate-x-full', 'opacity-0'));
            setTimeout(() => toast.remove(), 3000);
        }

        setInterval(() => {
            const now = new Date();
            document.getElementById('liveClock').innerText = now.toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
            document.getElementById('liveDate').innerText = now.toLocaleDateString([], {weekday:'long', month:'short', day:'numeric'});
        }, 1000);

        initAuth();
    </script>
</head>
<body class="bg-slate-50 h-screen overflow-hidden flex">

    <!-- AUTH SECTION (Login/Signup/Forgot) -->
    <!-- REVERTED: Clean Pattern Background -->
    <div id="authSection" class="fixed inset-0 z-50 flex items-center justify-center bg-slate-50 bg-[url('https://www.transparenttextures.com/patterns/cubes.png')]">
        
        <!-- Removed Dark Overlay -->

        <!-- Login Card -->
        <div class="bg-white p-8 rounded-2xl shadow-2xl w-full max-w-md border border-slate-100 relative overflow-hidden z-10">
            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-indigo-500 to-purple-500"></div>
            
            <!-- Header -->
            <div class="text-center mb-8">
                <!-- Reverted to Icon -->
                <div class="bg-indigo-50 w-16 h-16 rounded-full flex items-center justify-center mx-auto mb-4 text-indigo-600 text-2xl shadow-inner">
                    <i class="fas fa-chart-pie"></i>
                </div>
                <h1 class="text-2xl font-bold text-slate-800">Break Tracker Pro</h1>
            </div>

            <!-- LOGIN FORM -->
            <div id="form-login" class="auth-form form-container">
                <h2 class="text-lg font-semibold text-center mb-4 text-slate-700">Login to your account</h2>
                <form onsubmit="handleLogin(event)" class="space-y-4">
                    <div><input type="email" id="login-email" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Email Address" required></div>
                    <div><input type="password" id="login-pass" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Password" required></div>
                    <p id="login-error" class="text-rose-500 text-sm hidden text-center error-msg"></p>
                    <div class="flex justify-between items-center text-sm">
                        <label class="flex items-center text-slate-500"><input type="checkbox" class="mr-2 rounded text-indigo-600"> Remember me</label>
                        <a href="#" onclick="toggleAuthForm('forgot')" class="text-indigo-600 hover:underline">Forgot Password?</a>
                    </div>
                    <button type="submit" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-3 rounded-xl shadow-lg transition-all">Login</button>
                </form>
                <p class="text-center mt-6 text-sm text-slate-500">Don't have an account? <a href="#" onclick="toggleAuthForm('signup')" class="text-indigo-600 font-bold hover:underline">Sign Up</a></p>
            </div>

            <!-- SIGNUP FORM -->
            <div id="form-signup" class="auth-form form-container hidden">
                <h2 class="text-lg font-semibold text-center mb-4 text-slate-700">Create New Account</h2>
                <form onsubmit="handleSignup(event)" class="space-y-4">
                    <div><input type="text" id="signup-name" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Full Name" required></div>
                    <div><input type="email" id="signup-email" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Email Address" required></div>
                    <div><input type="password" id="signup-pass" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Create Password" required></div>
                    <p id="signup-error" class="text-rose-500 text-sm hidden text-center error-msg"></p>
                    <button type="submit" class="w-full bg-emerald-600 hover:bg-emerald-700 text-white font-bold py-3 rounded-xl shadow-lg transition-all">Create Account</button>
                </form>
                <p class="text-center mt-6 text-sm text-slate-500">Already have an account? <a href="#" onclick="toggleAuthForm('login')" class="text-indigo-600 font-bold hover:underline">Login</a></p>
            </div>

            <!-- FORGOT PASSWORD FORM -->
            <div id="form-forgot" class="auth-form form-container hidden">
                <h2 class="text-lg font-semibold text-center mb-2 text-slate-700">Reset Password</h2>
                <p class="text-center text-sm text-slate-500 mb-6">Enter your email to receive a reset link.</p>
                <form onsubmit="handleForgotPass(event)" class="space-y-4">
                    <div><input type="email" id="forgot-email" class="w-full px-4 py-3 rounded-xl bg-slate-50 border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none" placeholder="Email Address" required></div>
                    <p id="forgot-error" class="text-rose-500 text-sm hidden text-center error-msg"></p>
                    <button type="submit" class="w-full bg-slate-800 hover:bg-slate-900 text-white font-bold py-3 rounded-xl shadow-lg transition-all">Send Link</button>
                </form>
                <p class="text-center mt-6 text-sm text-slate-500"><a href="#" onclick="toggleAuthForm('login')" class="text-indigo-600 font-bold hover:underline"><i class="fas fa-arrow-left mr-1"></i> Back to Login</a></p>
            </div>
        </div>
    </div>

    <!-- DASHBOARD WRAPPER -->
    <div id="dashboardWrapper" class="hidden flex-1 flex h-screen overflow-hidden w-full">
        <!-- SIDEBAR -->
        <aside class="w-64 bg-white border-r border-slate-200 hidden md:flex flex-col z-10">
            <div class="h-16 flex items-center px-6 border-b border-slate-100">
                <!-- Reverted to Text Branding -->
                <div class="text-indigo-600 text-xl mr-2"><i class="fas fa-chart-pie"></i></div>
                <h1 class="font-bold text-slate-800 text-lg">Tracker<span class="text-indigo-600">Pro</span></h1>
            </div>
            <nav class="flex-1 p-4 space-y-1 overflow-y-auto">
                <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-2">Main</p>
                <button id="nav-dashboard" onclick="switchView('dashboard')" class="nav-item active w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors text-left"><i class="fas fa-columns w-5 text-center"></i> Dashboard</button>
                <button id="nav-team" onclick="switchView('team')" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors text-left text-slate-600 hover:bg-slate-50"><i class="fas fa-users w-5 text-center"></i> Team List</button>
                <button id="nav-history" onclick="switchView('history')" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors text-left text-slate-600 hover:bg-slate-50"><i class="fas fa-history w-5 text-center"></i> History</button>
                <p class="px-3 text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 mt-6">System</p>
                <button id="nav-settings" onclick="switchView('settings')" class="nav-item w-full flex items-center gap-3 px-3 py-2.5 rounded-lg text-sm font-medium transition-colors text-left text-slate-600 hover:bg-slate-50"><i class="fas fa-cog w-5 text-center"></i> Settings</button>
            </nav>
            <div class="p-4 border-t border-slate-100">
                <div class="flex items-center gap-3 mb-3">
                    <div id="userAvatarInitials" class="w-9 h-9 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-sm font-bold"></div>
                    <div class="flex-1 min-w-0"><p class="text-sm font-medium text-slate-900 truncate" id="welcomeUser">Loading...</p><p class="text-xs text-green-500 flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-500 rounded-full"></span> Online</p></div>
                </div>
                <button onclick="attemptLogout()" class="w-full border border-slate-200 hover:bg-slate-50 text-slate-600 py-1.5 rounded-md text-xs font-medium transition-colors">Logout</button>
            </div>
        </aside>

        <!-- MAIN CONTENT -->
        <main class="flex-1 flex flex-col min-w-0 bg-slate-50/50">
            <header class="bg-white border-b border-slate-200 h-16 px-8 flex items-center justify-between shrink-0 sticky top-0 z-20 glass-effect">
                <h2 class="text-lg font-semibold text-slate-800">Team Overview</h2>
                <div class="flex items-center gap-6">
                    <div class="hidden sm:block text-right"><p id="liveClock" class="text-sm font-bold text-slate-800 leading-none">00:00</p><p id="liveDate" class="text-xs text-slate-400 font-medium">Loading...</p></div>
                </div>
            </header>

            <div class="flex-1 overflow-y-auto p-8">
                <!-- DASHBOARD VIEW -->
                <div id="view-dashboard" class="app-view">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                        <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-indigo-50 text-indigo-600 flex items-center justify-center text-xl"><i class="fas fa-users"></i></div>
                            <div><p class="text-slate-400 text-xs font-bold uppercase">Total Agents</p><p class="text-2xl font-bold text-slate-800" id="statTotal">--</p></div>
                        </div>
                        <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-emerald-50 text-emerald-600 flex items-center justify-center text-xl"><i class="fas fa-laptop-code"></i></div>
                            <div><p class="text-slate-400 text-xs font-bold uppercase">Working Now</p><p class="text-2xl font-bold text-slate-800" id="statWorking">--</p></div>
                        </div>
                        <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm flex items-center gap-4">
                            <div class="w-12 h-12 rounded-full bg-rose-50 text-rose-600 flex items-center justify-center text-xl"><i class="fas fa-mug-hot"></i></div>
                            <div><p class="text-slate-400 text-xs font-bold uppercase">On Break</p><p class="text-2xl font-bold text-rose-600" id="statBreak">--</p></div>
                        </div>
                        <div class="bg-white rounded-xl p-5 border border-slate-100 shadow-sm flex items-center gap-4 relative overflow-hidden">
                            <div class="absolute top-0 right-0 p-2 opacity-10 text-6xl text-amber-500"><i class="fas fa-trophy"></i></div>
                            <div class="w-12 h-12 rounded-full bg-amber-50 text-amber-500 flex items-center justify-center text-xl z-10"><i class="fas fa-stopwatch"></i></div>
                            <div class="z-10"><p class="text-slate-400 text-xs font-bold uppercase">Highest Usage</p><div class="flex flex-col"><span class="text-lg font-bold text-slate-800 truncate max-w-[120px]" id="statTopName">--</span><span class="text-xs font-medium text-amber-600" id="statTopTime">--</span></div></div>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                        <div class="px-6 py-4 border-b border-slate-100 bg-slate-50/50"><h3 class="font-semibold text-slate-800">Real-time Status</h3></div>
                        <div class="overflow-x-auto">
                            <table class="min-w-full text-left">
                                <thead><tr class="bg-slate-50/50 text-xs uppercase tracking-wider text-slate-400 font-semibold border-b border-slate-100"><th class="px-6 py-4">Agent Name</th><th class="px-6 py-4">Current Status</th><th class="px-6 py-4">Daily Utilization</th><th class="px-6 py-4 text-right">Actions</th></tr></thead>
                                <tbody id="teamBody" class="divide-y divide-slate-50"><tr><td colspan="4" class="text-center py-12 text-slate-400"><i class="fas fa-circle-notch fa-spin mr-2"></i> Loading...</td></tr></tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- TEAM GRID VIEW -->
                <div id="view-team" class="app-view hidden">
                    <div class="flex justify-between items-end mb-6">
                        <div><h3 class="text-2xl font-bold text-slate-800">Team Directory</h3><p class="text-slate-500 text-sm">Visual overview of all registered agents.</p></div>
                    </div>
                    <div id="teamGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-4"></div>
                </div>

                <!-- HISTORY VIEW -->
                <div id="view-history" class="app-view hidden">
                    <h3 class="text-2xl font-bold text-slate-800 mb-6">Session Activity Log</h3>
                    <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                         <table class="min-w-full text-left">
                            <thead><tr class="bg-slate-50 text-xs uppercase tracking-wider text-slate-500 font-semibold border-b border-slate-100"><th class="px-6 py-4">Time</th><th class="px-6 py-4">Agent</th><th class="px-6 py-4">Action</th><th class="px-6 py-4">Details</th></tr></thead>
                            <tbody id="historyBody" class="divide-y divide-slate-50"></tbody>
                        </table>
                    </div>
                </div>

                <!-- SETTINGS VIEW -->
                <div id="view-settings" class="app-view hidden">
                    <div class="max-w-2xl">
                        <h3 class="text-2xl font-bold text-slate-800 mb-6">System Settings</h3>
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6 mb-6">
                            <div class="flex items-center gap-4">
                                <div class="w-16 h-16 rounded-full bg-indigo-100 text-indigo-600 flex items-center justify-center text-2xl font-bold"><i class="fas fa-user"></i></div>
                                <div><h3 class="text-xl font-bold text-slate-800" id="settingsName">User</h3><p class="text-slate-500" id="settingsRole">Agent</p></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="mt-6 text-center text-xs text-slate-400">&copy; 2025 Break Tracker Pro.</div>
            </div>
        </main>
    </div>
</body>
</html>
